#!/usr/bin/env Rscript
suppressPackageStartupMessages({
library(tidyverse)
library(tidymodels)
})
renv::install("tidyverse", "tidymodels")
renv::snapshot()
read_csv("../code/_targets/objects/data_long")
read_delim("../code/_targets/objects/data_long")
read_delim("../code/_targets/objects/data_long", delim = '\t')
read_delim("../data/utah_cbc_results_2021_2024.tsv", delim = '\t')
tmp <- read_delim("../code/_targets/objects/utah_train_data_matched_columns", delim = '\t')
tmp
tmp <- qs::qread("../code/_targets/objects/utah_train_data_matched_columns", delim = '\t')
tmp <- readRDS("../code/_targets/objects/utah_train_data_matched_columns", delim = '\t')
tmp <- readRDS("../code/_targets/objects/utah_train_data_matched_columns")
tmp
tmp |> slice_tail(n = 1000)
tmp |> slice_tail(n = 1000) |> select(PATIENT_ID = EPIC_MRN, DRAWN_DT_TM, ASSAY = TASK_ASSAY, RESULT = RESULT_VALUE_NUMERIC)
tmp |> slice_tail(n = 1000) |> select(PATIENT_ID = EPIC_MRN, DRAWN_DT_TM, ASSAY = TASK_ASSAY, RESULT = RESULT_VALUE_NUMERIC) |> filter(ASSAY %in% c("Hgb, Plt, WBC"))
tmp |> slice_tail(n = 1000) |> select(PATIENT_ID = EPIC_MRN, DRAWN_DT_TM, ASSAY = TASK_ASSAY, RESULT = RESULT_VALUE_NUMERIC) |> filter(ASSAY %in% c("Hgb", "Plt", "WBC"))
tmp |> slice_tail(n = 10000) |> select(PATIENT_ID = EPIC_MRN, DRAWN_DT_TM, ASSAY = TASK_ASSAY, RESULT = RESULT_VALUE_NUMERIC) |> filter(ASSAY %in% c("Hgb", "Plt", "WBC"))
tmp |> slice_tail(n = 10000) |> select(PATIENT_ID = EPIC_MRN, DRAWN_DT_TM, ASSAY = TASK_ASSAY, RESULT = RESULT_VALUE_NUMERIC) |> filter(ASSAY %in% c("Hgb", "Plt", "WBC")) |> mutate(DRAWN_DT_TM = DRAWN_DT_TM + 10000000)
tmp |> slice_tail(n = 10000) |> select(PATIENT_ID = EPIC_MRN, DRAWN_DT_TM, ASSAY = TASK_ASSAY, RESULT = RESULT_VALUE_NUMERIC) |> filter(ASSAY %in% c("Hgb", "Plt", "WBC")) |> mutate(DRAWN_DT_TM = DRAWN_DT_TM + 1000000000)
tmp |> slice_tail(n = 10000) |> select(PATIENT_ID = EPIC_MRN, DRAWN_DT_TM, ASSAY = TASK_ASSAY, RESULT = RESULT_VALUE_NUMERIC) |> filter(ASSAY %in% c("Hgb", "Plt", "WBC")) |> mutate(PATIENT_ID = as.numeric(as.factor(PATIENT_ID)), DRAWN_DT_TM = DRAWN_DT_TM + 1000000000)
tmp |> slice_tail(n = 10000) |> select(PATIENT_ID = EPIC_MRN, DRAWN_DT_TM, ASSAY = TASK_ASSAY, RESULT = RESULT_VALUE_NUMERIC) |> filter(ASSAY %in% c("Hgb", "Plt", "WBC")) |> mutate(PATIENT_ID = as.numeric(as.factor(PATIENT_ID)), DRAWN_DT_TM = DRAWN_DT_TM + 1000000000, RESULT = RESULT + RESULT * 0.01)
tmp |> slice_tail(n = 10000) |> select(PATIENT_ID = EPIC_MRN, DRAWN_DT_TM, ASSAY = TASK_ASSAY, RESULT = RESULT_VALUE_NUMERIC) |> filter(ASSAY %in% c("Hgb", "Plt", "WBC")) |> mutate(PATIENT_ID = as.numeric(as.factor(PATIENT_ID)), DRAWN_DT_TM = DRAWN_DT_TM + 1000000000, RESULT = RESULT + RESULT * 0.01) |> write_csv("sample_cbc_input.csv")
cbc_with_deltas |> filter(hours_since_prior <= 48 & hours_to_post <= 48)
